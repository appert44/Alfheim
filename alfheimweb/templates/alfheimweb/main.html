<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Projet Alfheim</title>
    <link rel='stylesheet' href='/static/alfheimweb/CSS/style.css'>
    <script language="javascript" type="text/javascript" src="/static/alfheimweb/js/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="/static/alfheimweb/js/jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="/static/alfheimweb/js/jquery.flot.navigate.js"></script>
    <script language="javascript" type="text/javascript" src="/static/alfheimweb/js/jquery.flot.selection.js"></script>
    <script language="javascript" type="text/javascript" src="/static/alfheimweb/js/jquery.flot.crosshair.js"></script>
<div class="logo">
        <img width="100%" height="160" src="/static/alfheimweb/images/fond_ciel.jpg" alt="Gestion energie">
</div>
 </head>
    <body>
<div class="accueil">

 {% if user.is_authenticated %}
 Bienvenue dans votre espace personnel {{ user.username }},
 {% else %}
    Merci de vous connecter.
 {% endif %}

</div>

<div class="disconnect">
	<form action="/alfheimweb/exit/" method="post">
		<input type="submit" value="Déconnexion" /></br></br></br>
	</form>
</div>

    <div id="placeholder"></div>

    <div class="options">
 	<p id="local">Localisation:</p>
    <form>
    <select id="localisation" size="1">
    <option>Maison Orvault
    <option>Maison Seychelles
    <option>Maison Corse
    </select>
    
    <p id="period">P&eacuteriode:</br></p>
    
	<input type="radio" name="period" value="last24h">24 dernières heures</br>
	<input type="radio" name="period" value="last7d">7 derniers jours</br>
	<input type="radio" name="period" value="last31d">31 derniers jours</br>
	<input type="radio" name="period" value="last3m">3 derniers mois</br>
	<input type="radio" name="period" value="last12m">12 derniers mois</br></br>
	</form>
	

    <input type=button name='refreshbp' value="Refresh" onClick="temperature()" /> 
    <input type=button name='testbp' value="Test" onClick="sensors()" /> 
    <p id="choices">Courbes:</br></p>
    
    </div>
    
    <div id="test3000"></div></div>
<script language="javascript" type="text/javascript">

function sensors(){
    $.ajax({
            type:"GET",
            url :"/alfheimweb/sensors/",
            datatype:"json",
            success: function(sens) {
                //obj = JSON.parse(data);
                document.getElementById('localisation').innerHTML = sens;
           },
           error:function(sens) {
               alert("error in getting from server")
           }
        });
    };  


function temperature(){
    $.ajax({
            type:"GET",
            url :"/alfheimweb/graph/",
            datatype:"json",
            success: function(temp) {
               set_graph(temp)
           },
           error:function(temp) {
               alert("error in getting from server")
   		   }
        });
    };  


function set_graph(data){
//$(function () {

	var datasets = data;

	var i = 0;
    $.each(datasets, function(key, val) {
        val.color = i;
        ++i;
    });
    
    // insert checkboxes 
    var choiceContainer = $("#choices");
    $.each(datasets, function(key, val) {
        choiceContainer.append('<br/><input type="checkbox" name="' + key +
                               '" checked="checked" id="id' + key + '">' +
                               '<label for="id' + key + '">'
                                + val.label + '</label>');
    });
    choiceContainer.find("input").click(plotAccordingToChoices);

    
    function plotAccordingToChoices() {
        var data = [];

        choiceContainer.find("input:checked").each(function () {
            var key = $(this).attr("name");
            if (key && datasets[key])
                data.push(datasets[key]);
        });

        if (data.length > 0)
            $.plot($("#placeholder"), data, {
                yaxis: { min: 0 },
                xaxis: {  tickDecimals: 0  }
            });
    }

    plotAccordingToChoices();
    
}
//}
set_graph();
  

</script>

</body>
</html>



</script>


 </body>
</html>
